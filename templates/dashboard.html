<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Báº£ng Ä‘iá»u khiá»ƒn</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:20px}
    .top{position:fixed;top:10px;right:20px;display:flex;gap:8px;align-items:center;background:#f5f7fb;border:1px solid #e3e7ef;padding:8px 12px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .btn{display:inline-block;background:#1677ff;color:#fff;text-decoration:none;padding:8px 12px;border-radius:8px}
    .btn.red{background:#e74c3c}
    .pill{background:#eef3ff;border:1px solid #d7e2ff;border-radius:999px;padding:4px 10px}
    .container{max-width:900px;margin:90px auto 40px}
    h1{margin:0 0 16px}
    .card{border:1px solid #e8e8e8;border-radius:12px;padding:14px 16px;margin-bottom:16px}
    .quiz{display:grid;grid-template-columns:160px 1fr;gap:14px;align-items:start}
    .quiz img{max-width:160px;border-radius:10px;border:1px solid #eee}
    .opts label{display:block;margin:6px 0}
    .status{font-size:14px;opacity:.8}
  </style>
</head>
<body>
  <div class="top">
    <span class="pill">ğŸ’ {{ diamonds }}</span>
    <a href="/shop" class="btn">ğŸ›’ Cá»­a hÃ ng</a>
    <a href="/logout" class="btn red">ÄÄƒng xuáº¥t</a>
  </div>

  <div class="container">
    <h1>Xin chÃ o {{ username }}{% if highest_rank %} â€¢ Rank: {{ highest_rank|replace('rank_','')|upper }}{% endif %}</h1>

    <div class="card">
      <h3>Äiá»ƒm danh háº±ng ngÃ y</h3>
      {% if new_claim %}
        <a class="btn" href="/claim/daily">ğŸ Nháº­n 10 kim cÆ°Æ¡ng</a>
      {% else %}
        <div class="status">âœ… HÃ´m nay báº¡n Ä‘Ã£ nháº­n thÆ°á»Ÿng.</div>
      {% endif %}
    </div>

    <h2>Nhiá»‡m vá»¥/Quiz</h2>

    {% if custom_quests %}
      {% for qid, q in custom_quests.items() %}
        <div class="card">
          <div class="quiz">
            <div>
              {% if q.image %}
                <img src="/{{ q.image }}" alt="quiz image">
              {% endif %}
            </div>
            <div>
              <h3>{{ q.title }}</h3>
              {% if q.question %}<p><b>CÃ¢u há»i:</b> {{ q.question }}</p>{% endif %}
              <p class="status">ThÆ°á»Ÿng: {{ q.reward }} ğŸ’</p>

              {% if q.status == 'available' or q.status == 'rejected' %}
                <form method="post" action="/submit_quiz/{{ qid }}">
                  <div class="opts">
                    {% for opt in q.options %}
                      <label>
                        <input type="radio" name="answer" value="{{ loop.index0 }}" required>
                        {{ opt }}
                      </label>
                    {% endfor %}
                  </div>
                  <button class="btn" type="submit">Ná»™p</button>
                  {% if q.status == 'rejected' %}
                    <span class="status">â›” Bá»‹ tá»« chá»‘i, báº¡n cÃ³ thá»ƒ ná»™p láº¡i.</span>
                  {% endif %}
                </form>
              {% elif q.status == 'waiting_approval' %}
                <div class="status">â³ ÄÃ£ ná»™p, chá» admin duyá»‡tâ€¦</div>
              {% elif q.status == 'approved' %}
                {% set ok = (q.get('approved_result') == 'correct') %}
                <div class="status">
                  âœ… ÄÃ£ duyá»‡t â€¢ Káº¿t quáº£:
                  {% if ok %}ÄÃºng! (+{{ q.reward }}ğŸ’){% else %}Sai.{% endif %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="status">ChÆ°a cÃ³ nhiá»‡m vá»¥.</div>
    {% endif %}
  </div>
</body>
</html>
