<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n tr·ªã</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <style>
    body{font-family:Arial,sans-serif;margin:20px}
    .wrap{display:grid;grid-template-columns:380px 1fr;gap:24px}
    .card{border:1px solid #e8e8e8;border-radius:12px;padding:14px 16px}
    .input{width:100%;padding:8px;border:1px solid #ddd;border-radius:8px;margin:6px 0}
    .btn{background:#1677ff;color:#fff;border:0;border-radius:8px;padding:8px 12px;cursor:pointer;text-decoration:none;display:inline-block}
    .btn.red{background:#e74c3c}
    table{border-collapse:collapse;width:100%}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;vertical-align:top}
    img{max-width:120px;border:1px solid #eee;border-radius:8px}
  </style>
</head>
<body>
  <div style="text-align:right;margin-bottom:12px">
    <a class="btn" href="/dashboard">‚¨Ö V·ªÅ trang ng∆∞·ªùi d√πng</a>
    <a class="btn red" href="/logout">ƒêƒÉng xu·∫•t</a>
  </div>

  <div class="wrap">
    <div class="card">
      <h3>T·∫°o quiz m·ªõi</h3>
      <form method="post" action="/create_quiz" enctype="multipart/form-data">
        <label>Ti√™u ƒë·ªÅ</label>
        <input class="input" name="title" required>

        <label>C√¢u h·ªèi</label>
        <textarea class="input" name="question" rows="3" required></textarea>

        <label>ƒê√°p √°n (4 l·ª±a ch·ªçn)</label>
        <input class="input" name="opt1" placeholder="L·ª±a ch·ªçn 1" required>
        <input class="input" name="opt2" placeholder="L·ª±a ch·ªçn 2" required>
        <input class="input" name="opt3" placeholder="L·ª±a ch·ªçn 3" required>
        <input class="input" name="opt4" placeholder="L·ª±a ch·ªçn 4" required>

        <label>ƒê√°p √°n ƒë√∫ng (0-3)</label>
        <input class="input" name="correct" type="number" min="0" max="3" value="0" required>

        <label>Ph·∫ßn th∆∞·ªüng (üíé)</label>
        <input class="input" name="reward" type="number" min="0" value="10" required>

        <label>·∫¢nh minh h·ªça (t√πy ch·ªçn)</label>
        <input class="input" type="file" name="image" accept=".png,.jpg,.jpeg,.webp,.gif">

        <label>Giao cho</label>
        <select class="input" name="target">
          <option value="ALL">T·∫•t c·∫£ ng∆∞·ªùi d√πng</option>
          {% for name, data in users.items() %}
            {% if name != 'admin' %}
              <option value="{{ name }}">{{ name }}</option>
            {% endif %}
          {% endfor %}
        </select>

        <button class="btn" type="submit">T·∫°o quiz</button>
      </form>
    </div>

    <div class="card">
      <h3>B√†i n·ªôp ch·ªù duy·ªát</h3>
      {% if pending %}
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Quiz</th>
              <th>·∫¢nh</th>
              <th>ƒê√°p √°n ch·ªçn</th>
              <th>ƒê√°p √°n ƒë√∫ng</th>
              <th>Th∆∞·ªüng</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            {% for p in pending %}
              <tr>
                <td><b>{{ p.username }}</b><br><small>{{ p.quiz.submitted_at }}</small></td>
                <td>
                  <div><b>{{ p.quiz.title }}</b></div>
                  <div>{{ p.quiz.question }}</div>
                  <ol>
                    {% for opt in p.quiz.options %}<li>{{ opt }}</li>{% endfor %}
                  </ol>
                </td>
                <td>
                  {% if p.quiz.image %}
                    <img src="/{{ p.quiz.image }}">
                  {% endif %}
                </td>
                <td>{{ p.quiz.options[p.quiz.user_answer] if p.quiz.user_answer is not none }}</td>
                <td>{{ p.quiz.options[p.quiz.answer] }}</td>
                <td>+{{ p.quiz.reward }}üíé</td>
                <td>
                  <form method="post" action="/approve_quiz/{{ p.username }}/{{ p.qid }}" style="display:inline">
                    <button class="btn" type="submit">Duy·ªát</button>
                  </form>
                  <form method="post" action="/reject_quiz/{{ p.username }}/{{ p.qid }}" style="display:inline">
                    <button class="btn red" type="submit">T·ª´ ch·ªëi</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div>Ch∆∞a c√≥ b√†i n·ªôp.</div>
      {% endif %}
    </div>
  </div>
</body>
</html>


